{"ast":null,"code":"var _s = $RefreshSig$();\nimport axios from \"axios\";\nimport useRefreshToken from \"./useRefreshToken\";\nimport { useUserContext } from \"../contexts/AuthContext\";\nimport { useEffect } from \"react\";\nconst BASE_URL = \"http://localhost:3000\";\nconst useAxiosPrivate = () => {\n  _s();\n  const axiosPrivate = axios.create({\n    baseURL: BASE_URL,\n    headers: {\n      \"Content-Type\": \"application/json\"\n    },\n    withCredentials: true\n  });\n  const refresh = useRefreshToken();\n  const {\n    accessToken\n  } = useUserContext();\n  useEffect(() => {\n    const requestIntercept = axiosPrivate.interceptors.request.use(config => {\n      if (!config.headers[\"Authorization\"]) {\n        config.headers[\"Authorization\"] = `Bearer ${accessToken}`;\n      }\n      return config;\n    }, error => Promise.reject(error));\n    const responseIntercept = axiosPrivate.interceptors.response.use(response => response, async error => {\n      var _error$response, _error$response$data;\n      const prevRequest = error === null || error === void 0 ? void 0 : error.config;\n      if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.code) === 403 && !(prevRequest !== null && prevRequest !== void 0 && prevRequest.sent)) {\n        prevRequest.sent = true;\n        const newAccessToken = await refresh();\n        prevRequest.headers[\"Authorization\"] = `Bearer ${newAccessToken}`;\n        return axiosPrivate(prevRequest);\n      }\n      return Promise.reject(error);\n    });\n    return () => {\n      axiosPrivate.interceptors.request.eject(requestIntercept);\n      axiosPrivate.interceptors.response.eject(responseIntercept);\n    };\n  }, [accessToken, refresh]);\n  return axiosPrivate;\n};\n_s(useAxiosPrivate, \"255rCGCoNcH1gkLzYPkifneqTWk=\", false, function () {\n  return [useRefreshToken, useUserContext];\n});\nexport default useAxiosPrivate;","map":{"version":3,"names":["axios","useRefreshToken","useUserContext","useEffect","BASE_URL","useAxiosPrivate","_s","axiosPrivate","create","baseURL","headers","withCredentials","refresh","accessToken","requestIntercept","interceptors","request","use","config","error","Promise","reject","responseIntercept","response","_error$response","_error$response$data","prevRequest","data","code","sent","newAccessToken","eject"],"sources":["C:/Users/mereb/Documents/git_repos/TipTap/TipTap/frontend/tiptap/src/hooks/useAxiosPrivate.js"],"sourcesContent":["import axios from \"axios\";\r\nimport useRefreshToken from \"./useRefreshToken\";\r\nimport { useUserContext } from \"../contexts/AuthContext\";\r\nimport { useEffect } from \"react\";\r\nconst BASE_URL = \"http://localhost:3000\";\r\n\r\nconst useAxiosPrivate = () => {\r\n  const axiosPrivate = axios.create({\r\n    baseURL: BASE_URL,\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    withCredentials: true,\r\n  });\r\n\r\n  const refresh = useRefreshToken();\r\n  const { accessToken } = useUserContext();\r\n\r\n  useEffect(() => {\r\n    const requestIntercept = axiosPrivate.interceptors.request.use(\r\n      (config) => {\r\n        if (!config.headers[\"Authorization\"]) {\r\n          config.headers[\"Authorization\"] = `Bearer ${accessToken}`;\r\n        }\r\n        return config;\r\n      },\r\n      (error) => Promise.reject(error)\r\n    );\r\n\r\n    const responseIntercept = axiosPrivate.interceptors.response.use(\r\n      (response) => response,\r\n      async (error) => {\r\n        const prevRequest = error?.config;\r\n        if (error?.response?.data?.code === 403 && !prevRequest?.sent) {\r\n          prevRequest.sent = true;\r\n          const newAccessToken = await refresh();\r\n          prevRequest.headers[\"Authorization\"] = `Bearer ${newAccessToken}`;\r\n          return axiosPrivate(prevRequest);\r\n        }\r\n        return Promise.reject(error);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      axiosPrivate.interceptors.request.eject(requestIntercept);\r\n      axiosPrivate.interceptors.response.eject(responseIntercept);\r\n    };\r\n  }, [accessToken, refresh]);\r\n\r\n  return axiosPrivate;\r\n};\r\n\r\nexport default useAxiosPrivate;\r\n"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,eAAe,MAAM,mBAAmB;AAC/C,SAASC,cAAc,QAAQ,yBAAyB;AACxD,SAASC,SAAS,QAAQ,OAAO;AACjC,MAAMC,QAAQ,GAAG,uBAAuB;AAExC,MAAMC,eAAe,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAC5B,MAAMC,YAAY,GAAGP,KAAK,CAACQ,MAAM,CAAC;IAChCC,OAAO,EAAEL,QAAQ;IACjBM,OAAO,EAAE;MAAE,cAAc,EAAE;IAAmB,CAAC;IAC/CC,eAAe,EAAE;EACnB,CAAC,CAAC;EAEF,MAAMC,OAAO,GAAGX,eAAe,CAAC,CAAC;EACjC,MAAM;IAAEY;EAAY,CAAC,GAAGX,cAAc,CAAC,CAAC;EAExCC,SAAS,CAAC,MAAM;IACd,MAAMW,gBAAgB,GAAGP,YAAY,CAACQ,YAAY,CAACC,OAAO,CAACC,GAAG,CAC3DC,MAAM,IAAK;MACV,IAAI,CAACA,MAAM,CAACR,OAAO,CAAC,eAAe,CAAC,EAAE;QACpCQ,MAAM,CAACR,OAAO,CAAC,eAAe,CAAC,GAAI,UAASG,WAAY,EAAC;MAC3D;MACA,OAAOK,MAAM;IACf,CAAC,EACAC,KAAK,IAAKC,OAAO,CAACC,MAAM,CAACF,KAAK,CACjC,CAAC;IAED,MAAMG,iBAAiB,GAAGf,YAAY,CAACQ,YAAY,CAACQ,QAAQ,CAACN,GAAG,CAC7DM,QAAQ,IAAKA,QAAQ,EACtB,MAAOJ,KAAK,IAAK;MAAA,IAAAK,eAAA,EAAAC,oBAAA;MACf,MAAMC,WAAW,GAAGP,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAED,MAAM;MACjC,IAAI,CAAAC,KAAK,aAALA,KAAK,wBAAAK,eAAA,GAALL,KAAK,CAAEI,QAAQ,cAAAC,eAAA,wBAAAC,oBAAA,GAAfD,eAAA,CAAiBG,IAAI,cAAAF,oBAAA,uBAArBA,oBAAA,CAAuBG,IAAI,MAAK,GAAG,IAAI,EAACF,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAEG,IAAI,GAAE;QAC7DH,WAAW,CAACG,IAAI,GAAG,IAAI;QACvB,MAAMC,cAAc,GAAG,MAAMlB,OAAO,CAAC,CAAC;QACtCc,WAAW,CAAChB,OAAO,CAAC,eAAe,CAAC,GAAI,UAASoB,cAAe,EAAC;QACjE,OAAOvB,YAAY,CAACmB,WAAW,CAAC;MAClC;MACA,OAAON,OAAO,CAACC,MAAM,CAACF,KAAK,CAAC;IAC9B,CACF,CAAC;IAED,OAAO,MAAM;MACXZ,YAAY,CAACQ,YAAY,CAACC,OAAO,CAACe,KAAK,CAACjB,gBAAgB,CAAC;MACzDP,YAAY,CAACQ,YAAY,CAACQ,QAAQ,CAACQ,KAAK,CAACT,iBAAiB,CAAC;IAC7D,CAAC;EACH,CAAC,EAAE,CAACT,WAAW,EAAED,OAAO,CAAC,CAAC;EAE1B,OAAOL,YAAY;AACrB,CAAC;AAACD,EAAA,CA1CID,eAAe;EAAA,QAOHJ,eAAe,EACPC,cAAc;AAAA;AAoCxC,eAAeG,eAAe"},"metadata":{},"sourceType":"module","externalDependencies":[]}